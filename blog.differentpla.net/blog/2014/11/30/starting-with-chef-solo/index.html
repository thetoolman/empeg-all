<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width initial-scale=1" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Starting with chef-solo</title>
<meta name="description" content="Jekyll sources for blog.differentpla.net">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"> 
<!-- theme is https://bootswatch.com/yeti/ -->
<link rel="stylesheet" href="../../../../../css/yeti/bootstrap.min.css">
<link rel="stylesheet" href="../../../../../css/yeti-custom.css">
<link rel="stylesheet" href="../../../../../css/site.css">

<link rel="canonical" href="index.html">
<link type="application/atom+xml" rel="alternate" href="../../../../../feed.xml" title="Roger's Blog" />
</head>


<body>

<div class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <ul class="nav navbar-nav navbar-left">
                <li><a class="navbar-brand" href="../../../../../index.html">Roger's Blog</a></li>
            </ul>
        </div>
    </div>
</div>



<div class="container">
    <article>
    <h1>Starting with chef-solo</h1>
    <div class="details">
        <span class="created_at timeago" title="2014-11-30 18:39:07 +0000">2014-11-30 18:39:07 +0000</span>
        
        <span class="label label-default"><a href="../../../../../tag/chef">chef</a></span>
        
    </div>
    <p></p>
    <p><em>This is part of my <a href="../../13/website-rebuild/index.html">quest to sort out my website</a>.
Starting with chef-solo.</em></p>

<p>Earlier in this quest, I talked about
<a href="../../13/chef-solo-vagrant/index.html">using Chef Solo with Vagrant</a>.</p>

<p>Now we need to use it in AWS. This is essentially the same as using it on any
other server, but it’s different from using it in Vagrant, where the Vagrant
provision did some of the work for us.</p>

<p><strong>Note:</strong> I <em>could</em> have used vagrant to configure the AWS instance; I didn’t
want to mess around with AWS Access Keys and secrets today. In future, I might
explore using vagrant to manage this.</p>

<h2 id="revision-control">Revision Control</h2>

<p>Because I’m that kind of person, and because it’s the right thing to do, I’m
going to keep as much of this under revision control as possible. In short,
that means <a href="https://github.com/rlipscombe/chef-repo">github</a>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/rlipscombe/chef-repo
</code></pre></div></div>

<h2 id="solorb">solo.rb</h2>

<p><code class="highlighter-rouge">chef-solo</code> needs a configuration file, called <code class="highlighter-rouge">solo.rb</code>. It looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssl_verify_mode :verify_peer
cookbook_path File.expand_path("../cookbooks", __FILE__)
json_attribs File.expand_path("../node.json", __FILE__)
</code></pre></div></div>

<h2 id="nodejson">node.json</h2>

<p>We want to put our node into at least one role, so put the following in the
node.json file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "run_list": [ "role[base]" ]
}
</code></pre></div></div>

<h2 id="roles">Roles</h2>

<p>Create a file, <code class="highlighter-rouge">roles/base.rb</code> containing:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name 'base'

run_list(
        'apt'
)
</code></pre></div></div>

<h2 id="cookbooks">Cookbooks</h2>

<p>We’re managing the cookbooks with berkshelf, so we’ll need a <code class="highlighter-rouge">Berksfile</code> that looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source "https://supermarket.getchef.com"

cookbook 'apt'
</code></pre></div></div>

<p>And then we’ll need to install those cookbooks:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>berks install
berks vendor cookbooks/
</code></pre></div></div>

<h2 id="running-chef-solo">Running chef-solo</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/chef-repo
sudo chef-solo -c solo.rb
</code></pre></div></div>

<h2 id="hurrah">Hurrah!</h2>

<p>And that should happily “converge”, meaning that it’s run <code class="highlighter-rouge">apt-get update</code> for us.</p>

</article>

</div>

<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.4.0/jquery.timeago.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
        $('.timeago').timeago();
        $('div.body > h1, h2, h3, h4, h5, h6').each(function(i) {
            $(this).append(
            '<a class="anchorlink" title="Link to ' +
                $(this).text() + '" href="index.html#' + $(this).attr('id') + '"></a>');
            });
        });
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40120477-1', 'auto');
  ga('send', 'pageview');

</script>
</body>

</html>
