<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width initial-scale=1" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Using kerl with direnv</title>
<meta name="description" content="Jekyll sources for blog.differentpla.net">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"> 
<!-- theme is https://bootswatch.com/yeti/ -->
<link rel="stylesheet" href="../../../../../css/yeti/bootstrap.min.css">
<link rel="stylesheet" href="../../../../../css/yeti-custom.css">
<link rel="stylesheet" href="../../../../../css/site.css">

<link rel="canonical" href="index.html">
<link type="application/atom+xml" rel="alternate" href="../../../../../feed.xml" title="Roger's Blog" />
</head>


<body>

<div class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <ul class="nav navbar-nav navbar-left">
                <li><a class="navbar-brand" href="../../../../../index.html">Roger's Blog</a></li>
            </ul>
        </div>
    </div>
</div>



<div class="container">
    <article>
    <h1>Using kerl with direnv</h1>
    <div class="details">
        <span class="created_at timeago" title="2014-09-30 00:00:00 +0000">2014-09-30 00:00:00 +0000</span>
        
    </div>
    <p></p>
    <p><code class="highlighter-rouge">kerl</code> allows you to easily build and install multiple Erlang/OTP releases.
It’s kinda like <code class="highlighter-rouge">nvm</code> or <code class="highlighter-rouge">rvm</code>, but for Erlang. It doesn’t do everything, and
that’s what <code class="highlighter-rouge">direnv</code> is for. <code class="highlighter-rouge">direnv</code> allows you to run commands upon entering
or leaving a particular directory.</p>

<h2 id="installing-direnv">Installing <code class="highlighter-rouge">direnv</code></h2>

<p><strong>direnv</strong> requires <strong>make</strong> and <strong>go</strong> to be installed, so on Ubuntu, that’s:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install make golang
</code></pre></div></div>

<p>On Mac OS X, that’s:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew update ; brew install go
</code></pre></div></div>

<p>Then follow (more-or-less) the instructions at
https://github.com/zimbatm/direnv#install:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone http://github.com/zimbatm/direnv
cd direnv
make
sudo make install       # sudo is optional on OS X.
</code></pre></div></div>

<p>To track the current directory, <strong>direnv</strong> hooks your shell. On <strong>bash</strong>, it
hooks <code class="highlighter-rouge">$PROMPT_COMMAND</code>. To get this to work, add the following near the end of
your <code class="highlighter-rouge">.bashrc</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type -P direnv &amp;&gt;/dev/null &amp;&amp; eval "$(direnv hook bash)"
</code></pre></div></div>

<p>This is slightly different from the installation instructions on the direnv
homepage, because my bash profile is shared between all of the machines I use,
and not all of them will have direnv installed.</p>

<h2 id="installing-kerl">Installing <code class="highlighter-rouge">kerl</code></h2>

<p>See https://github.com/yrashk/kerl#downloading, but it’s essentially this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -O https://raw.githubusercontent.com/spawngrid/kerl/master/kerl
chmod +x kerl
</code></pre></div></div>

<p>Note that, if you put kerl in <code class="highlighter-rouge">$PATH</code> for your primary user account, it
probably won’t be available when attempting to run it via <code class="highlighter-rouge">sudo</code>, so it’s
probably easier to put it in (e.g.) <code class="highlighter-rouge">/usr/local/bin</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mv kerl /usr/local/bin
</code></pre></div></div>

<h2 id="using-kerl-to-build-and-install-erlang">Using <code class="highlighter-rouge">kerl</code> to build and install Erlang</h2>

<p>In this example, I’ll show building R16B03-1, with the default settings. This
is the version used at Electric Imp at the time of writing.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kerl list releases

kerl build R16B03-1 r16b03-1
kerl list builds

sudo kerl install r16b03-1 /usr/local/erlang-R16B03-1
kerl list installations
</code></pre></div></div>

<h2 id="activating-an-erlang-version-using-kerl">Activating an Erlang version using <code class="highlighter-rouge">kerl</code></h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. /usr/local/erlang-R16B03-1/activate
</code></pre></div></div>

<h2 id="combining-kerl-with-direnv">Combining <code class="highlighter-rouge">kerl</code> with <code class="highlighter-rouge">direnv</code></h2>

<p>What if your team doesn’t use the same locations for installing Erlang versions
with <strong>kerl</strong>? Then you need the following in your <code class="highlighter-rouge">.envrc</code> file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERLANG_VERSION=r16b03-1

if has kerl; then
    ERLANG_INSTALLATION=$(kerl list installations | grep "^$ERLANG_VERSION " | cut -d' ' -f2)
    if [ -x "$ERLANG_INSTALLATION/activate" ] ; then
        echo "Using Erlang $ERLANG_VERSION (in $ERLANG_INSTALLATION) via kerl."
        . $ERLANG_INSTALLATION/activate
    else
        echo "Erlang $ERLANG_VERSION not available; using default."
    fi
else
    echo "kerl not available; using default Erlang."
fi
</code></pre></div></div>

</article>

</div>

<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.4.0/jquery.timeago.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
        $('.timeago').timeago();
        $('div.body > h1, h2, h3, h4, h5, h6').each(function(i) {
            $(this).append(
            '<a class="anchorlink" title="Link to ' +
                $(this).text() + '" href="index.html#' + $(this).attr('id') + '"></a>');
            });
        });
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40120477-1', 'auto');
  ga('send', 'pageview');

</script>
</body>

</html>
